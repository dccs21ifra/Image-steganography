<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Your Message</title>
    <style>
        body {
            background-color: #3498db;
            font-family: Arial, sans-serif;
        }

        form {
            margin: 20px;
        }

        input, button {
            margin: 10px 0;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        #imageInsertion, #encryptMessage, #saveImage {
            background-color: #3498db;
            box-shadow: 0 0 10px rgb(241, 238, 238);
            margin: 150px auto;
            padding: 30px;
            max-width: 400px;
        }

        button {
            color: white;
            background-color: darkblue;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: darkblue;
        }

        input:hover, input:focus {
            border-color: #f2f3f5;
        }

        h1, h2, p, label {
            color: white;
            text-align: center;
            font-family: Arial, sans-serif;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 10px;
        }

        input {
            padding: 10px;
            margin-bottom: 16px;
            border: 1px solid rgb(253, 253, 253);
            border-radius: 8px;
        }

        .decrypt-button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: darkblue;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .decrypt-button:hover {
            background-color: darkblue;
        }

    </style>
</head>
<body>

<!-- Page 1: Image Insertion -->
<section id="imageInsertion">
    <h1>Insert Image</h1>
    <form onsubmit="goToEncryptMessage(); return false;">
        <label for="image">Insert Image:</label>
        <input type="file" id="image" accept="image/*" required><br>
        <button type="submit">Next</button>
    </form>
</section>

<!-- Page 2: Encrypt Message -->
<section id="encryptMessage" style="display: none;">
    <h1>Encrypt Message</h1>
    <form onsubmit="saveAndEncrypt(); return false;">
        <label for="message">Enter Message to Encrypt:</label>
        <textarea id="textToTransfer"></textarea>
        <label for="predefinedMessages">Predefined Messages:</label>
        <select id="predefinedMessages" onchange="insertPredefinedMessage()">
            <option value="" selected disabled>Select a message</option>
            <option value="Hello, world!">Hello, world!</option>
            <option value="Good morning!">Good morning!</option>
            <option value="How are you?">How are you?</option>
        </select><br>
        <button onclick="saveText()">Encrypt and Save Text</button>
    </form>
</section>

<!-- Page 3: Save Image and Decrypt Message -->
<section id="saveImage" style="display: none;">
    <h1>Save Image and Decrypt Message</h1>
    <img id="resultImage" alt="Result Image"><br>
    <button onclick="decryptMessage()">Decrypt Message</button>
    <h2>Decrypted Message:</h2>
    <p id="decryptedMessage"></p>
    <button class="decrypt-button" onclick="goToDecryptPage()">Go to Decrypt Page</button>
</section>

<script>
    let encryptedMessage = '';

    function goToEncryptMessage() {
        document.getElementById('imageInsertion').style.display = 'none';
        document.getElementById('encryptMessage').style.display = 'block';
    }

    function saveAndEncrypt() {
        const messageInput = document.getElementById('textToTransfer').value; // corrected id
        encryptedMessage = messageInput.replace(/[a-zA-Z]/g, function(char) {
            const code = char.charCodeAt(0);
            return String.fromCharCode(code + 1);
        });
        goToSaveImage();
    }

    function goToSaveImage() {
        const imageInput = document.getElementById('image');
        const resultImageElement = document.getElementById('resultImage');
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        const img = new Image();
        img.onload = function () {
            canvas.width = img.width;
            canvas.height = img.height;
            context.drawImage(img, 0, 0);
            resultImageElement.src = canvas.toDataURL();
            document.getElementById('encryptMessage').style.display = 'none';
            document.getElementById('saveImage').style.display = 'block';
        };
        img.src = URL.createObjectURL(imageInput.files[0]);
    }

    function saveText() {
        var text = document.getElementById('textToTransfer').value;
        localStorage.setItem('savedText', text);
    }

    function decryptMessage() {
        const decryptedMessageElement = document.getElementById('decryptedMessage');
        const decryptedMessage = encryptedMessage.replace(/[a-zA-Z]/g, function(char) {
            const code = char.charCodeAt(0);
            return String.fromCharCode(code - 1);
        });
        decryptedMessageElement.innerText = decryptedMessage;
    }

    function goToDecryptPage() {
        const encryptedMessageParam = encodeURIComponent(encryptedMessage);
        window.location.href = 'decrypt.html?encryptedMessage=' + encryptedMessageParam;
    }

    function insertPredefinedMessage() {
        const messageTextarea = document.getElementById('textToTransfer');
        const predefinedMessagesDropdown = document.getElementById('predefinedMessages');
        if (predefinedMessagesDropdown.value !== "") {
            messageTextarea.value = predefinedMessagesDropdown.value;
        }
    }
</script>

</body>
</html>
